/*
 Copyright 2015 Logentries.
 Please view license at https://raw.github.com/logentries/le_js/master/LICENSE
*/
(function(b,e){"function"===typeof define&&define.amd?define(function(){return e(b)}):"object"===typeof exports?("object"===typeof global&&(b=global),module.exports=e(b)):b.LE=e(b)})(this,function(b){function e(a){var d=a.trace?(Math.random()+Math.PI).toString(36).substring(2,10):null,g=a.page_info,e=a.token,h=a.print,f=a.no_format,r;r="undefined"===typeof XDomainRequest?a.ssl:"https:"===b.location.protocol?!0:!1;var l;l=b.LEENDPOINT?b.LEENDPOINT:f?"webhook.logentries.com/noformat":"js.logentries.com/v1";
l=(r?"https://":"http://")+l+"/logs/"+e;var k=[],m=!1,t=!1;if(a.catchall){var u=b.onerror;b.onerror=function(a,b,c,d,g){n({error:a,line:c,column:d,location:b,stack:g?g.stack:void 0}).level("ERROR").send();return u?u(a,b,c,d,g):!1}}var q=function(){var a=b.navigator||{doNotTrack:void 0},d=b.screen||{},c=b.location||{};return{url:c.pathname+c.search+c.hash,referrer:document.referrer,screen:{width:d.width,height:d.height},window:{width:b.innerWidth,height:b.innerHeight},browser:{name:a.appName,user_agent:a.userAgent,
version:a.appVersion,cookie_enabled:a.cookieEnabled,do_not_track:a.doNotTrack},platform:a.platform}},v=function(){var a=Array.prototype.slice.call(arguments);if(0===a.length)throw Error("No arguments!");return 1===a.length?a[0]:a},n=function(a){var b=v.apply(this,arguments),c={event:b};"never"===g||t&&"per-entry"!==g||(t=!0,"undefined"===typeof b.screen&&"undefined"===typeof b.browser&&n(q()).level("PAGE").send());d&&(c.trace=d);return{level:function(a){if(h&&"undefined"!==typeof console&&"PAGE"!==
a){var b=null;"undefined"!==typeof XDomainRequest&&(b=c.trace+" "+c.event);try{console[a.toLowerCase()].call(console,b||c)}catch(w){console.log(b||c)}}c.level=a;return{send:function(){var a=[],b=JSON.stringify(c,function(b,c){if("undefined"===typeof c)return"undefined";if("object"===typeof c&&null!==c){var d;a:{for(d=0;d<a.length;d++)if(c===a[d])break a;d=-1}if(-1!==d)return"<?>";a.push(c)}return c});m?k.push(b):p(e,b)}}}}};this.log=n;var p=function(a,b){m=!0;var c;c="undefined"!==typeof XDomainRequest?
new XDomainRequest:new XMLHttpRequest;c.constructor===XMLHttpRequest?c.onreadystatechange=function(){4===c.readyState&&(400<=c.status?(console.error("Couldn't submit events."),410===c.status&&console.warn("This version of le_js is no longer supported!")):(301===c.status&&console.warn("This version of le_js is deprecated! Consider upgrading."),0<k.length?p(a,k.shift()):m=!1))}:c.onload=function(){0<k.length?p(a,k.shift()):m=!1};c.open("POST",l,!0);c.constructor===XMLHttpRequest&&(c.setRequestHeader("X-Requested-With",
"XMLHttpRequest"),c.setRequestHeader("Content-type","application/json"));c.overrideMimeType&&c.overrideMimeType("text");c.send(b)}}function q(a){var b,d={ssl:!0,catchall:!1,trace:!0,page_info:"never",print:!1,endpoint:null,token:null};if("object"===typeof a)for(var f in a)d[f]=a[f];else throw Error("Invalid parameters for createLogStream()");if(null===d.token)throw Error("Token not present.");b=new e(d);var h=function(a){if(b)return b.log.apply(this,arguments);throw Error("You must call LE.init(...) first.");
};return{log:function(){h.apply(this,arguments).level("LOG").send()},warn:function(){h.apply(this,arguments).level("WARN").send()},error:function(){h.apply(this,arguments).level("ERROR").send()},info:function(){h.apply(this,arguments).level("INFO").send()}}}var d={},f=function(a){if("string"!==typeof a.name)throw Error("Name not present.");if(d.hasOwnProperty(a.name))throw Error("A logger with that name already exists!");d[a.name]=new q(a);return!0};return{init:function(a){var b={name:"default"};
if("object"===typeof a)for(var d in a)b[d]=a[d];else if("string"===typeof a)b.token=a;else throw Error("Invalid parameters for init()");return f(b)},createLogStream:f,to:function(a){if(!d.hasOwnProperty(a))throw Error("Invalid name for logStream");return d[a]},destroy:function(a){"undefined"===typeof a&&(a="default");delete d[a]},log:function(){for(var a in d)d[a].log.apply(this,arguments)},warn:function(){for(var a in d)d[a].warn.apply(this,arguments)},error:function(){for(var a in d)d[a].error.apply(this,
arguments)},info:function(){for(var a in d)d[a].info.apply(this,arguments)}}});
